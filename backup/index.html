<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Prioritizer - Asisten Tugas Harian</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="images/prio.png" sizes="32x32" href="/favicon-32x32.png">


    <style>
        body { font-family: 'Inter', sans-serif; }
        .task-card { transition: all 0.3s ease; }
        .task-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .completed { text-decoration: line-through; opacity: 0.6; }
        .priority-badge { font-size: 0.7rem; font-weight: 600; padding: 2px 8px; border-radius: 9999px; }
        .priority-high { background-color: #FECACA; color: #991B1B; }
        .priority-medium { background-color: #FEF3C7; color: #92400E; }
        .priority-low { background-color: #D1FAE5; color: #065F46; }

        @keyframes rotate {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

        .gradient {
        --size: 750px;
        --speed: 50s;
        --easing: cubic-bezier(0.8, 0.2, 0.2, 0.8);
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 0;
        pointer-events: none;
        width: var(--size);
        height: var(--size);
        filter: blur(calc(var(--size) / 8));
        background-image: radial-gradient(circle at 30% 25%,
        rgba(56,189,248,0.95) 0%,
        rgba(99,102,241,0.9) 35%,
        rgba(16,185,129,0.88) 70%);
        animation: rotate var(--speed) var(--easing) alternate infinite;
        border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
        transition: top 0.6s ease-out, left 0.6s ease-out; /* ini bikin gerakan smooth */
        }

        /* pastikan kontainer konten berada di atas gradient */
        #app-container {
        position: relative;
        z-index: 1;
        }

        @media (min-width: 720px) {
        .gradient { --size: 500px; }
        }

        body {
        background-color: #071c39 !important;
        position: absolute;
        inset: 0;
        display: flex;
        place-content: center;
        align-items: center;
        overflow: hidden;
        }
        </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <!-- pindahkan gradient ke sini, sebagai sibling #app-container -->
    <div class="gradient" aria-hidden="true"></div>
    <div id="app-container" class="max-w-4xl mx-auto p-4 md:p-8">
        <header id= "header" class="mb-8 text-center text-white space-800">
            <h1 class="text-3xl font-bold mb-2">Task Prioritizer</h1>
            <p class="text-white-400">Your Daily College Assignment Assistant</p>
        </header>
        <!-- Elemen UI untuk Login dan Logout -->
        <div id="auth-container" class="mb-6 text-center">
            <!-- Tombol Login akan muncul di sini jika belum login -->
            <div id="login-view">
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button id="login-button" class="bg-white text-slate-700 font-semibold py-2 px-6 border border-slate-300 rounded-lg shadow-sm hover:bg-slate-100 transition-colors flex items-center justify-center w-full sm:w-auto">
                        <svg class="w-5 h-5 mr-3" viewBox="0 0 48 48" width="48px" height="48px"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.574l6.19,5.238C39.902,36.632,44,30.852,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
                        Login dengan Google
                    </button>
                    <button id="guest-login-button" class="bg-slate-600 text-white font-semibold py-2 px-6 rounded-lg shadow-sm hover:bg-slate-700 transition-colors w-full sm:w-auto">
                        Masuk sebagai Tamu
                    </button>
                </div>
            </div>
            <!-- Info pengguna akan muncul di sini jika sudah login -->
            <div id="user-view" class="hidden">
                 <p class="text-sm  text-lime-500 mb-2">Login With <strong id="user-email"></strong></p>
                 <button id="logout-button" class="bg-red-500 text-white font-semibold py-1 px-4 text-sm rounded-lg hover:bg-red-600 transition-colors">Logout</button>
            </div>
        </div>

        <main id="main-content" class="hidden">
            <!-- Form dan Daftar Tugas akan muncul di sini SETELAH login -->
            <div class="bg-white p-6 rounded-xl shadow-md mb-8">
                <h2 class="text-xl font-semibold mb-4">Your New Added Task</h2>
                <form id="task-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="md:col-span-2">
                        <label for="task-name" class="block text-sm font-medium text-slate-700 mb-1">Name Task</label>
                        <input type="text" id="task-name" placeholder="Example: working on a thesis or journal" required class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="task-urgency" class="block text-sm font-medium text-slate-700 mb-1">Urgency (1-5)</label>
                        <input type="range" id="task-urgency" min="1" max="5" value="3" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        <span id="urgency-value" class="text-sm text-slate-500">3 (Quite Urgency)</span>
                    </div>
                    <div>
                        <label for="task-importance" class="block text-sm font-medium text-slate-700 mb-1">Importance (1-5)</label>
                        <input type="range" id="task-importance" min="1" max="5" value="3" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        <span id="importance-value" class="text-sm text-slate-500">3 (Quite Importance)</span>
                    </div>
                    <div class="md:col-span-2">
                        <label for="task-time" class="block text-sm font-medium text-slate-700 mb-1">Estimade Time (Hours)</label>
                        <input type="number" id="task-time" min="0.5" step="0.5" value="1" required class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="md:col-span-2">
                        <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                            Prioritize & Add Task
                        </button>
                    </div>
                </form>
            </div>
            
            <div>
                <h2 class="text-white font-semibold mb-4">Your To-Do List (Sorted)</h2>
                <div id="task-list" class="space-y-4">
                    <p id="loading-tasks" class="text-slate-500 text-center">Memuat tugas...</p>
                </div>
            </div>
        </main>
    </div>
    </body>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        // Perubahan: Impor fungsi signInAnonymously
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, serverTimestamp, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC4WwUhxG5XROTr5lSHvhDS4zj2Lqmw1U0",
            authDomain: "asisten-tugas-pribadi.firebaseapp.com",
            projectId: "asisten-tugas-pribadi",
            storageBucket: "asisten-tugas-pribadi.appspot.com",
            messagingSenderId: "994319187177",
            appId: "1:994319187177:web:58ebbc1fce8645eabd4478"
        };
        
        let db, auth, userId, unsubscribeTasks;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'asisten-tugas-pribadi';

        const app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        auth = getAuth(app);

        // --- Elemen UI ---
        const loginView = document.getElementById('login-view');
        const userView = document.getElementById('user-view');
        const mainContent = document.getElementById('main-content');
        const userEmailSpan = document.getElementById('user-email');
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const guestLoginButton = document.getElementById('guest-login-button'); // Tombol baru
        const taskListDiv = document.getElementById('task-list');

        // --- Fungsi untuk memulai proses login dengan Google ---
        const signInWithGoogle = async () => {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error("Error saat login dengan Google:", error);
                alert("Gagal login dengan Google. Silakan coba lagi.");
            }
        };
        
        // --- BARU: Fungsi untuk login sebagai tamu / guest ---
        const signInAsGuest = async () => {
            try {
                await signInAnonymously(auth);
            } catch (error) {
                console.error("Error signing in as Guest:", error);
                alert("Failed Login as Guest. Try again.");
            }
        };

        // --- Fungsi untuk logout ---
        const doSignOut = async () => {
            try {
                await signOut(auth);
            } catch (error) {
                console.error("Error saat logout:", error);
            }
        };

        // Tambahkan event listener ke tombol
        loginButton.addEventListener('click', signInWithGoogle);
        guestLoginButton.addEventListener('click', signInAsGuest); // Event listener baru
        logoutButton.addEventListener('click', doSignOut);
        
        // --- Logika `onAuthStateChanged` yang diperbarui ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // --- KONDISI SAAT PENGGUNA LOGIN ---
                userId = user.uid; 
                
                // BARU: Cek apakah pengguna anonim atau pengguna Google
                if (user.isAnonymous) {
                    userEmailSpan.innerHTML = `Guest <span class="font-normal text-slate-400 text-xs">(${user.uid.substring(0, 6)}...)</span>`;
                } else {
                    userEmailSpan.textContent = user.email;
                }
                
                // Tampilkan UI untuk pengguna yang sudah login
                loginView.classList.add('hidden');
                userView.classList.remove('hidden');
                mainContent.classList.remove('hidden');

                // Mulai mendengarkan data tugas milik pengguna ini
                listenToTasks();

            } else {
                // --- KONDISI SAAT PENGGUNA LOGOUT ---
                userId = null;

                // Tampilkan UI untuk login
                loginView.classList.remove('hidden');
                userView.classList.add('hidden');
                mainContent.classList.add('hidden');

                // Hentikan listener data & bersihkan daftar tugas
                if (unsubscribeTasks) {
                    unsubscribeTasks();
                }
                renderTasks([]); 
            }
        });

        function listenToTasks() {
            if (!userId) return;
            if (unsubscribeTasks) {
                unsubscribeTasks();
            }
            const q = query(getTasksCollectionRef());
            unsubscribeTasks = onSnapshot(q, (querySnapshot) => {
                let tasks = [];
                querySnapshot.forEach((doc) => tasks.push({ id: doc.id, ...doc.data() }));
                tasks.sort((a, b) => b.priorityScore - a.priorityScore);
                renderTasks(tasks);
            });
        }
        
        function renderTasks(tasks) {
            if (tasks.length === 0) {
                taskListDiv.innerHTML = `<div class="text-center p-8 bg-white rounded-lg shadow-md"><h3 class="font-semibold text-lg">No Have Task</h3><p class="text-slate-500 mt-1">Add a task to get started.</p></div>`;
                return;
            }
            taskListDiv.innerHTML = tasks.map(task => {
                const priorityClass = task.priorityScore > 15 ? 'priority-high' : (task.priorityScore > 8 ? 'priority-medium' : 'low');
                const priorityText = task.priorityScore > 15 ? 'High' : (task.priorityScore > 8 ? 'Medium' : 'Low');
                
                return `
                <div class="task-card bg-white p-4 rounded-xl shadow-md flex items-start gap-4 ${task.status === 'completed' ? 'opacity-60' : ''}">
                    <input type="checkbox" onchange="toggleTaskStatus('${task.id}', '${task.status}')" class="mt-1.5 h-5 w-5 rounded" ${task.status === 'completed' ? 'checked' : ''}>
                    <div class="flex-grow">
                        <div class="flex justify-between items-start">
                           <p class="font-semibold text-lg ${task.status === 'completed' ? 'line-through' : ''}">${task.name}</p>
                           <span class="priority-badge ${priorityClass}">${priorityText} (${task.priorityScore})</span>
                        </div>
                        <div class="text-sm text-slate-500 mt-2 flex gap-4">
                            <span>Urgency: <strong>${task.urgency}</strong></span>
                            <span>Importance: <strong>${task.importance}</strong></span>
                            <span>Time: <strong>${task.time} hours</strong></span>
                        </div>
                    </div>
                    <button onclick="deleteTask('${task.id}')" class="text-slate-400 hover:text-red-500 p-1">
                        <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                    </button>
                </div>`;
            }).join('');
        }

        // --- Fungsi lainnya (helper & CRUD) tetap sama ---
        const urgencyLabels = { 1: 'very low', 2: 'low', 3: 'medium', 4: 'urgent', 5: 'very urgent' };
        const importanceLabels = { 1: 'not important', 2: 'less important', 3: 'quite important', 4: 'important', 5: 'very important' };
        const urgencySlider = document.getElementById('task-urgency');
        const importanceSlider = document.getElementById('task-importance');
        const urgencyValue = document.getElementById('urgency-value');
        const importanceValue = document.getElementById('importance-value');
        urgencySlider.addEventListener('input', () => { urgencyValue.textContent = `${urgencySlider.value} (${urgencyLabels[urgencySlider.value]})`; });
        importanceSlider.addEventListener('input', () => { importanceValue.textContent = `${importanceSlider.value} (${importanceLabels[importanceSlider.value]})`; });
        function calculatePriorityScore(urgency, importance, time) { return parseFloat(((urgency * 3.5) + (importance * 2.5) - (time * 0.5)).toFixed(2)); }
        const getTasksCollectionRef = () => collection(db, `artifacts/${appId}/users/${userId}/tasks`);
        document.getElementById('task-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const taskName = document.getElementById('task-name').value;
            const urgency = parseInt(document.getElementById('task-urgency').value);
            const importance = parseInt(document.getElementById('task-importance').value);
            const time = parseFloat(document.getElementById('task-time').value);
            const priorityScore = calculatePriorityScore(urgency, importance, time);
            await addDoc(getTasksCollectionRef(), { name: taskName, urgency, importance, time, priorityScore, status: 'pending', createdAt: serverTimestamp() });
            e.target.reset();
            urgencyValue.textContent = '3 (Sedang)';
            importanceValue.textContent = '3 (Cukup Penting)';
        });
        window.toggleTaskStatus = async (taskId, currentStatus) => {
            const newStatus = currentStatus === 'pending' ? 'completed' : 'pending';
            const taskDocRef = doc(db, `artifacts/${appId}/users/${userId}/tasks`, taskId);
            await updateDoc(taskDocRef, { status: newStatus });
        };
        window.deleteTask = async (taskId) => {
            if (confirm('Yakin ingin menghapus tugas ini?')) {
                const taskDocRef = doc(db, `artifacts/${appId}/users/${userId}/tasks`, taskId);
                await deleteDoc(taskDocRef);
            }
        };

 // === Efek gradient mengikuti kursor (versi lembut) ===
const gradientEl = document.querySelector('.gradient');
let targetX = window.innerWidth / 2;
let targetY = window.innerHeight / 2;
let currentX = targetX;
let currentY = targetY;

document.addEventListener('mousemove', (e) => {
  targetX = e.clientX;
  targetY = e.clientY;
});

function animate() {
  currentX += (targetX - currentX) * 0.1; // smoothing
  currentY += (targetY - currentY) * 0.1;
  gradientEl.style.left = `${(currentX / window.innerWidth) * 100}%`;
  gradientEl.style.top = `${(currentY / window.innerHeight) * 100}%`;
  requestAnimationFrame(animate);
}
animate();

    </script>
</body>
</html>

